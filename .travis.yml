language: rust
cache:
  cargo: true
rust: nightly-2017-08-04
dist: trusty
sudo: true
jobs:
  include:
    - stage: build & test
      script:
        - |
          apt-get update -q; sudo apt-get install --allow-change-held-packages libsnappy-dev  capnproto  libgoogle-perftools-dev  libssl-dev libudev-dev  rabbitmq-server  google-perftools jq
          /etc/init.d/rabbitmq-server restart
          echo "1) clean"
          make clean || exit 1
          echo "2) setup"
          make setup || exit 1
          echo "3) build"
          make debug || exit 1
          echo "4) unit test"
          make test || exit 1
